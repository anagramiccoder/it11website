---
import Layout from '../layouts/Layout.astro';
import esg7inf from '../assets/BSES Group 7.png';
import esg8inf from '../assets/BSES Group 8.jpg';
import fg2inf from '../assets/BSF Group 2.png';
import fg5inf from '../assets/BSF Group 5.jpg';
import esg8ad from '../assets/BSES G8.webm';
import esg7ad from '../assets/bses g7.webm';
const projectsData = [
    {
        id: 1,
        title: 'Phishing',
        category: 'Infographics',
        desc: 'Infographics about Phishing created by Accad, Cainglit, Recodos, Isla, Silac',
        src: esg7inf.src,
        thumb: esg7inf.src,
        mediaType: 'long-image'
    },
    {
        id: 2,
        title: 'Unseen Threats: Hacking',
        category: 'Infographics',
        desc: 'Infographics About hacking created by Galacgac, Ilar, Pijera, Battulayan, Morella',
        src: esg8inf.src,
        thumb: esg8inf.src,
        mediaType: 'long-image'
    },
    {
        id: 3,
        title: 'Cyberbullying',
        category: 'Infographics',
        desc: 'Infographics about Cyberbullying created by Ra√±a, Cariaga, Bangayan, Lazaro, Guillermo, Sacro',
        src: fg2inf.src,
        thumb: fg2inf.src,
        mediaType: 'longimage'
    },
    {
        id: 4,
        title: 'Cyberbullying Awareness',
        category: 'Infographics',
        desc: 'Infographics about Cyberbullying created by Calantes, Cuma, Pailma, Rosini, Quicquic',
        src: fg5inf.src,
        thumb: fg5inf.src,
        mediaType: 'long-image'
    },
    {
        id: 5,
        title: 'Hacking Advocacy',
        category: 'Advocacy',
        desc: 'Advocacy video on ethical hacking and cybersecurity awareness for students and professionals. Video by Galacgac, Ilar, Pijera, Battulayan, Morella',
        src: esg8ad,
        thumb: esg8ad,
        mediaType: 'video',
        isVideo: true
    },
    {
        id: 6,
        title: 'Phishing Advocacy',
        category: 'Advocacy',
        desc: 'Advocacy video on Phishing. Video by Accad, Cainglit, Recodos, Isla, Silac',
        src: esg7ad,
        thumb: esg7ad,
        mediaType: 'video',
        isVideo: true
    }
];
---

<Layout title="Projects">
    <section class="py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-end mb-12">
                <div>
                    <h2 class="text-3xl font-bold text-white">Selected Outputs for viewing.</h2>
                    <p class="text-gray-400 mt-2">Click an image to view details.</p>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-grid">
                <!-- Projects will be loaded here -->
            </div>
        </div>
    </section>

    <div id="image-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/90 transition-opacity backdrop-blur-sm" id="modal-backdrop"></div>
        <div class="relative z-10 w-full max-w-3xl mx-4 rounded-xl overflow-hidden">
            <div class="relative transform overflow-hidden rounded-xl bg-tech-surface text-left shadow-xl border border-gray-700">
                    <div class="absolute right-0 top-0 pr-4 pt-4 z-10">
                        <button type="button" id="modal-close" class="rounded-md bg-transparent text-gray-400 hover:text-white focus:outline-none">
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                    <div class="flex flex-col" id="modal-content-container">
                        <!-- Standard Media Container -->
                        <div id="standard-media" class="w-full h-80 sm:h-96 bg-black flex items-center justify-center overflow-hidden">
                            <img id="modal-image" src="" alt="Project Detail" class="w-full h-full object-contain">
                            <video id="modal-video" class="w-full h-full object-contain hidden" controls></video>
                        </div>

                        <!-- Long Image Container -->
                        <div id="long-image-container" class="hidden w-full bg-black flex flex-col h-screen sm:h-[90dvh]">
                            <div class="bg-tech-surface px-4 py-3 border-b border-gray-700">
                                <h3 class="text-xl font-semibold leading-6 text-white" id="modal-title-long"></h3>
                            </div>
                            <div class="flex-1 overflow-y-auto overflow-x-hidden flex items-start justify-center p-4">
                                <img id="modal-image-long" src="" alt="Full Image" class="max-w-full h-auto object-contain">
                            </div>
                        </div>

                        <!-- Standard Content Section -->
                        <div id="standard-content" class="bg-tech-surface px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                            <h3 class="text-xl font-semibold leading-6 text-white" id="modal-title"></h3>
                            <p class="text-sm text-gray-400 mt-2" id="modal-desc"></p>
                        </div>
                        <div id="standard-footer" class="bg-gray-900 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                            <button type="button" id="modal-close-btn" class="inline-flex w-full justify-center rounded-lg bg-tech-surface px-3 py-2 text-sm font-semibold text-white shadow-sm ring-1 ring-inset ring-gray-600 hover:bg-gray-700 sm:mt-0 sm:w-auto transition-colors">Close Viewer</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script define:vars={{ projectsData }}>
        const projects = projectsData;
        const modal = document.getElementById('image-modal');
        const modalImg = document.getElementById('modal-image');
        const modalVideo = document.getElementById('modal-video');
        const modalTitle = document.getElementById('modal-title');
        const modalDesc = document.getElementById('modal-desc');
        const backdrop = document.getElementById('modal-backdrop');
        const closeBtn = document.getElementById('modal-close');
        const closeBtnBottom = document.getElementById('modal-close-btn');
        const projectsGrid = document.getElementById('projects-grid');

        function renderProjects() {
            projectsGrid.innerHTML = projects.map(project => `
                <div class="project-card group relative cursor-pointer overflow-hidden rounded-xl bg-gray-800"
                     data-id="${project.id}"
                     data-title="${project.title}"
                     data-desc="${project.desc}"
                     data-src="${project.src}"
                     data-type="${project.mediaType}">
                    ${project.isVideo 
                        ? `<div class="w-full h-64 bg-gradient-to-br from-blue-900 to-cyan-900 flex items-center justify-center transition-transform duration-300 group-hover:scale-110 opacity-70 group-hover:opacity-100">
                            <svg class="w-16 h-16 text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
                            </svg>
                        </div>`
                        : `<img src="${project.thumb}" class="w-full h-64 object-cover transition-transform duration-300 group-hover:scale-110 opacity-70 group-hover:opacity-100" alt="${project.title}">`
                    }
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 to-transparent flex flex-col justify-end p-6">
                        <span class="text-tech-accent text-xs font-mono mb-1">${project.category}</span>
                        <h3 class="text-white font-bold text-lg">${project.title}</h3>
                    </div>
                </div>
            `).join('');

            // Add event listeners to project cards
            document.querySelectorAll('.project-card').forEach(card => {
                card.addEventListener('click', () => {
                    const title = card.dataset.title;
                    const desc = card.dataset.desc;
                    const src = card.dataset.src;
                    const type = card.dataset.type;
                    openModal(title, desc, src, type);
                });
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        const title = card.dataset.title;
                        const desc = card.dataset.desc;
                        const src = card.dataset.src;
                        const type = card.dataset.type;
                        openModal(title, desc, src, type);
                    }
                });
            });
        }

        function openModal(title, desc, src, mediaType) {
            if(!modal) return;
            
            const standardMedia = document.getElementById('standard-media');
            const longImageContainer = document.getElementById('long-image-container');
            const standardContent = document.getElementById('standard-content');
            const standardFooter = document.getElementById('standard-footer');
            const modalImageLong = document.getElementById('modal-image-long');
            const modalTitleLong = document.getElementById('modal-title-long');
            
            if(mediaType === 'long-image') {
                // Hide standard elements
                standardMedia.classList.add('hidden');
                standardContent.classList.add('hidden');
                standardFooter.classList.add('hidden');
                
                // Show long-image elements
                longImageContainer.classList.remove('hidden');
                modalTitleLong.innerText = title;
                modalImageLong.src = src;
            } else {
                // Show standard elements
                standardMedia.classList.remove('hidden');
                standardContent.classList.remove('hidden');
                standardFooter.classList.remove('hidden');
                
                // Hide long-image elements
                longImageContainer.classList.add('hidden');
                
                modalTitle.innerText = title;
                modalDesc.innerText = desc;
                
                if(mediaType === 'video') {
                    modalImg.classList.add('hidden');
                    modalVideo.classList.remove('hidden');
                    modalVideo.src = src;
                } else {
                    modalVideo.classList.add('hidden');
                    modalImg.classList.remove('hidden');
                    modalImg.src = src;
                }
            }
            
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal?.classList.add('hidden');
            modalVideo.pause();
        }

        closeBtn.addEventListener('click', closeModal);
        closeBtnBottom.addEventListener('click', closeModal);
        backdrop.addEventListener('click', closeModal);

        document.addEventListener('keydown', (e) => {
            if(e.key === 'Escape') closeModal();
        });

        renderProjects();
    </script>
</Layout>